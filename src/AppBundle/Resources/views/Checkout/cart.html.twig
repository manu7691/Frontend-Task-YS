{% extends "::base.html.twig" %}

{% block title %}OnePage Checkout{% endblock %}

{% block body %}
    <div class="checkout">
        <h5 class="checkout__title centered">Checkout</h5>
        <div class="checkout__forms">
            <div class="checkout__form_user">

                <div class="checkout__form_user__address_data">
                    <h5 class="checkout__title">Delivery address</h5>
                    <label for="form_first_name">
                        First Name <span class="circle__required"></span><input type="text" id="form_first_name" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_last_name">
                        Last Name <span class="circle__required"></span><input type="text" id="form_last_name" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_email">
                        E-mail <span class="circle__required"></span><input type="email" id="form_email" required="required">
                        <div class="data--is_invalid">It has to be a proper email</div>
                        <div class="data--is_invalid error-format">Format for this email is wrong</div>
                    </label>
                    <label for="form_phone">
                        Phone <input type="tel" id="form_phone">
                    </label>
                    <label for="form_address_1">
                        Address <span class="circle__required"></span><input type="text" id="form_address_1" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_address_2">
                        Address 2 <input type="text" id="form_address_2">
                    </label>
                    <label for="form_postcode">
                        Zip Code <span class="circle__required"></span><input type="text" id="form_postcode" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_city">
                        City <span class="circle__required"></span><input type="text" id="form_city" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_state">
                        State <span class="circle__required"></span><input type="text" id="form_state" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_country">
                        Country <span class="circle__required"></span>
                        <select id="form_country" required="required">
                            <option value="">Choose Country</option>
                            <option value="US">United States</option>
                            <option value="PL">Poland</option>
                        </select>
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                </div>

                <div class="checkout__form_user__payment_data">
                    <h5 class="checkout__title">Payment</h5>
                    <label for="form_card_data">
                        Card Number <span class="circle__required"></span><input type="text" maxlength="20" id="form_card_data" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_card_holder">
                        Card Holder <span class="circle__required"></span><input type="text" id="form_card_holder" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                    <label for="form_card_cvc">
                        CVC <span class="circle__required"></span><input type="text" id="form_card_cvc" required="required">
                        <div class="data--is_invalid">It can't be empty</div>
                    </label>
                </div>

                <div class="btn_checkout" >Checkout</div>

            </div>

            <div class="checkout__cart">

                <h5 class="checkout__title">Order</h5>

                <div class="checkout__cart_item">
                    <div>
                        <div class="checkout__cart_item_data">
                            <h5 class="checkout__title">Nike Air Mag</h5>
                            <label for="checkout__cart_item_qty">Qty<span>-</span></label>
                            <label for="checkout__cart_item_price">Price<span>-</span></label>
                        </div>
                        <div class="checkout__cart_item_img">
                            <img width="100%" src="{{ asset('bundles/app/img/product-1.jpg') }}">
                        </div>
                    </div>
                </div>

                <div class="checkout__cart_total">
                    <div>
                        <div class="checkout__cart_item_data">
                            <label for="checkout__cart_total_subtotal">Subtotal<span>-</span></label>
                            <label for="checkout__cart_total_tax">Tax<span>-</span></label>
                            <label for="checkout__cart_total_shipping">Shipping<span>-</span></label>
                            <label for="checkout__cart_total_total"><strong>Total</strong><span>-</span></label>
                        </div>

                    </div>
                </div>

                <div class="checkout__cart_empty">
                    <div>
                        <div class="checkout__cart_item_data">
                            <label for="checkout__cart_total_total">Ohh, Your cart is empty!!!</label>
                        </div>

                    </div>
                </div>

            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}

    <script>
        $(function(){
            var currency = 'PLN';
            var shippingCost = 20;
            var taxPercentage = 19;
            var randomPrice = 40;
            var numItemsCart = localStorage['items_cart'] || 0; /* for integers */
            if(numItemsCart == 0){
                $('.checkout__cart_item').remove();
                $('.checkout__cart_total').remove();
                $('.checkout__cart_empty').show();
            }else{
                var total = (numItemsCart * randomPrice) + shippingCost;
                var taxes = total * (taxPercentage/100);
                var subtotal = total - taxes;

                $("label[for='checkout__cart_item_qty'] span").html(numItemsCart);
                $("label[for='checkout__cart_item_price'] span").html(randomPrice+currency);

                $("label[for='checkout__cart_total_subtotal'] span").html(subtotal+currency);
                $("label[for='checkout__cart_total_tax'] span").html(taxes+currency);
                $("label[for='checkout__cart_total_shipping'] span").html(shippingCost+currency);
                $("label[for='checkout__cart_total_total'] span").html(total+'PLN');
            }


            $.fn.hasAttr = function(name) {
                return this.attr(name) !== undefined;
            };
            function validateEmail(email) {
                var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                return re.test(email);
            }

            $formCheckout = $('.checkout__form_user  label input');
            $btnCheckout = $('.btn_checkout');

            $formCheckout.on('change focus keyup',function(){
                if(!$(this).val() && $(this).hasAttr('required')){
                    $(this).parent().addClass('error');
                }else{
                    if($(this).parent().hasClass('error')){
                        if(($(this)[0].id === 'form_email' && !validateEmail($(this).val()))){
                            $('.error-format').show();
                        }else{
                            if($(this)[0].id === 'form_email'){
                                $('.error-format').hide();
                            }
                            $(this).parent().removeClass('error');
                        }
                    }
                }
            });

            $selectCountry = $('.checkout__form_user  label select ');
            $selectCountry.on('change',function(){
                if(!$(this).val()){
                    $(this).parent().addClass('error');
                }else if($(this).parent().hasClass('error')){
                    $(this).parent().removeClass('error');
                }
            });

            $btnCheckout.on('click',function(){
                $formCheckout.trigger('change');
                $selectCountry.trigger('change');
                setTimeout(function(){
                    if(!$formCheckout.parent().hasClass('error') && !$selectCountry.parent().hasClass('error'))
                        alert('Checkout Complete! :D')
                },200);

            });

        });
    </script>

{% endblock %}
